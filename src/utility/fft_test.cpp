//
//  fft_test.cpp
//  Feynman_Simulator
//
//  Created by Kun Chen on 10/23/14.
//  Copyright (c) 2014 Kun Chen. All rights reserved.
//

#include "fft.h"
#include "sput.h"

void Test_fft1D();
void Test_fft2D();
void Test_fft3D();

int TestFFT()
{
    sput_start_testing();
    sput_enter_suite("Test fft1D...");
    sput_run_test(Test_fft1D);

    //    sput_enter_suite("Test fft2D...");
    //    sput_run_test(Test_fft2D);
    //
    sput_enter_suite("Test fft3D...");
    sput_run_test(Test_fft3D);
    sput_finish_testing();
    return sput_get_return_value();
    return 0;
}

bool CheckArray(Complex *source, Complex *target, int size)
{
    for (int i = 0; i < size; i++) {
        if (!Equal(source[i], target[i], 1e-5))
            return false;
    }
    return true;
}

void OutputAll(Complex *data, int size)
{
    for (int i = 0; i < size; i++) {
        std::cout.precision(15);
        std::cout << std::fixed << data[i] << std::endl;
    }
}

void Test_fft1D()
{
    Complex in[8] = {0, 1, 2, 3, 4, 5, 6, 7};
    Complex out[8] =
        {{28.000000000000000, 0.000000000000000},
         {-4.000000000000000, 9.656854249492380},
         {-4.000000000000000, 4.000000000000000},
         {-4.000000000000000, 1.656854249492380},
         {-4.000000000000000, 0.000000000000000},
         {-4.000000000000000, -1.656854249492380},
         {-4.000000000000000, -4.000000000000000},
         {-3.999999999999999, -9.656854249492380}};
    fft(in, 8, 1);
    sput_fail_unless(CheckArray(in, out, 8), "Check fft 1d");
}

void Test_fft3D()
{
    const int Nx = 4;
    const int Ny = 4;
    const int Nz = 4;
    unsigned int shape[] = {Nx, Ny, Nz};
    Complex in[Nx][Ny][Nz];
    for (int i = 0;
         i < shape[0]; i++)
        for (int j = 0; j < shape[1]; j++)
            for (int k = 0; k < shape[2]; k++)
                in[i][j][k] = (i * i + j * j) * cos(k);
    fft3D((Complex *)in, Nx, Ny, Nz, 1);
    extern Complex out3D[];
    sput_fail_unless(CheckArray((Complex *)in, (Complex *)out3D, Nx * Ny * Nz), "Check fft 3d");
}

Complex out3D[] = {
    {15.026252944701824, 0.000000000000000},
    {158.608445693279975, -171.393017876481508},
    {115.756855668738297, 0.000000000000000},
    {158.608445693279975, 171.393017876481508},
    {-2.146607563528832, 4.293215127057663},
    {26.311084294240445, 69.801415609005915},
    {-16.536693666962616, 33.073387333925226},
    {-71.627783063749007, 20.831981930011203},
    {-3.219911345293248, 0.000000000000000},
    {-33.987524077131425, 36.727075259246050},
    {-24.805040500443916, 0.000000000000000},
    {-33.987524077131411, -36.727075259246050},
    {-2.146607563528831, -4.293215127057663},
    {-71.627783063749007, -20.831981930011196},
    {-16.536693666962609, -33.073387333925226},
    {26.311084294240452, -69.801415609005915},
    {-2.146607563528832, 4.293215127057663},
    {26.311084294240434, 69.801415609005929},
    {-16.536693666962616, 33.073387333925218},
    {-71.627783063748993, 20.831981930011192},
    {-0.000000000000000, 0.000000000000002},
    {0.000000000000004, 0.000000000000010},
    {0.000000000000000, 0.000000000000000},
    {-0.000000000000004, -0.000000000000004},
    {-0.000000000000001, -0.000000000000001},
    {-0.000000000000002, 0.000000000000000},
    {0.000000000000000, -0.000000000000002},
    {-0.000000000000002, -0.000000000000002},
    {-0.000000000000000, 0.000000000000000},
    {-0.000000000000004, -0.000000000000004},
    {0.000000000000000, 0.000000000000000},
    {0.000000000000004, 0.000000000000004},
    {-3.219911345293249, 0.000000000000000},
    {-33.987524077131440, 36.727075259246035},
    {-24.805040500443916, 0.000000000000000},
    {-33.987524077131425, -36.727075259246035},
    {-0.000000000000001, -0.000000000000001},
    {0.000000000000002, 0.000000000000000},
    {0.000000000000000, 0.000000000000000},
    {0.000000000000000, -0.000000000000002},
    {0.000000000000002, 0.000000000000000},
    {0.000000000000004, -0.000000000000004},
    {0.000000000000002, 0.000000000000000},
    {-0.000000000000004, 0.000000000000004},
    {-0.000000000000001, 0.000000000000001},
    {0.000000000000000, 0.000000000000005},
    {0.000000000000000, 0.000000000000000},
    {-0.000000000000002, -0.000000000000007},
    {-2.146607563528831, -4.293215127057663},
    {-71.627783063749007, -20.831981930011199},
    {-16.536693666962609, -33.073387333925218},
    {26.311084294240441, -69.801415609005915},
    {0.000000000000000, 0.000000000000000},
    {-0.000000000000004, -0.000000000000003},
    {0.000000000000000, 0.000000000000000},
    {0.000000000000004, 0.000000000000004},
    {-0.000000000000001, 0.000000000000001},
    {0.000000000000002, 0.000000000000007},
    {-0.000000000000000, 0.000000000000002},
    {-0.000000000000005, -0.000000000000005},
    {0.000000000000000, -0.000000000000002},
    {0.000000000000004, -0.000000000000004},
    {0.000000000000000, 0.000000000000000},
    {-0.000000000000004, -0.000000000000004},
};